!function(t,r){"use strict";"object"==typeof module&&module.exports?module.exports=r():t.OCask=r()}("undefined"!=typeof window?window:this,function(){function t(t,i,e){var o=0,h=0,n=t;n.rowArr.push(i);for(var s=0;s<n.rowArr.length;s++)(o+=n.rowArr[s].width)>n.conWidth&&(n.rowArr.pop(),0!==s?(o-=i.width,h=n.conWidth*(n.baseHeight/o),r(n,h,!1,!1)):0===s&&r(n,n.conWidth,!0,!1),n.rowArr=[i]);if(0!==n.rowArr.length&&e===n.imgArr.length-1){if(1===n.rowArr.length)return void r(n,n.conWidth,!0,!1);n.isGap?(h=n.baseHeight,r(n,h,!1,!0)):(h=n.conWidth*(n.baseHeight/o),r(n,h,!1,!1))}}function r(t,r,i,e){var o=t,h=document.createElement("div");h.style.whiteSpace="nowrap";for(var n=[],s=0,a=0;a<o.rowArr.length;a++){var c=o.rowArr[a];if(i)s=Math.round(c.height/c.width*r),c.dom.width=r,c.dom.height=s;else{var d=Math.round(c.scale*r);if(n.push(d),s=Math.round(r),!e&&a===o.rowArr.length-1){for(var g=a+1,l=0;g--;)l+=n[g];var w=o.conWidth-l;(w>0||w<0)&&(d+=w)}c.dom.height=s,c.dom.width=d}o.imgClass&&c.dom.setAttribute("class",o.imgClass),h.style.height=s+"px",o.rowClass&&h.setAttribute("class",o.rowClass),h.appendChild(c.dom)}o.container.appendChild(h),o.cacheImgRow.push(h)}function i(r){window.onresize=function(){if(r.container.offsetWidth!==r.conWidth){r.conWidth=r.container.offsetWidth,r.rowArr=[];for(var i=r.container.childNodes,e=i.length-1;e>=0;e--)r.container.removeChild(i[e]);for(var e=0;e<r.cacheImg.length;e++)t(r,r.cacheImg[e],e)}}}var e=function(t){this.container=t.container,this.conWidth=this.container.offsetWidth,this.baseHeight=t.baseHeight||200,this.imgArr=t.imgArr,this.isGap=t.isGap,this.responsive=t.responsive,this.rowClass=t.rowClass||"",this.imgClass=t.imgClass||"",this.rowArr=[],this.cacheImg=[],this.cacheImgRow=[]};return e.prototype={getImgs:function(r){var e=this;if(0!==e.imgArr.length){var o=function(h){var n=new Image;n.src=e.imgArr[h],n.onload=function(n){return h===e.imgArr.length-1&&e.responsive&&i(e),function(){var i=n.width/n.height,s={dom:n,scale:i,height:e.baseHeight,width:e.baseHeight*i};t(e,s,h),e.cacheImg.push(s),e.imgArr[h+1]?o(h+1):r()}}(n)};o(0)}}},e});