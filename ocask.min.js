!function(t,i){"use strict";"object"==typeof module&&module.exports?module.exports=i():t.OCask=i()}("undefined"!=typeof window?window:this,function(){function t(t,r,e){var o=0,n=0,h=t;h.rowArr.push(r);for(var a=0;a<h.rowArr.length;a++)(o+=h.rowArr[a].width)>h.conWidth&&(h.rowArr.pop(),0!==a?(o-=r.width,n=h.conWidth*(h.baseHeight/o),i(h,n,!1,!1)):0===a&&i(h,h.conWidth,!0,!1),h.rowArr=[r]);if(0!==h.rowArr.length&&e===h.imgArr.length-1){if(1===h.rowArr.length)return void i(h,h.conWidth,!0,!0);h.isGap?(n=h.baseHeight,i(h,n,!1,!0)):(n=h.conWidth*(h.baseHeight/o),i(h,n,!1,!0))}}function i(t,i,r,e){var o=t,n=document.createElement("div");n.style.whiteSpace="nowrap";for(var h=[],a=0,s=0;s<o.rowArr.length;s++){var l=o.rowArr[s];if(r)a=Math.round(l.height/l.width*i),l.dom.width=i,l.dom.height=a;else{var c=Math.round(l.scale*i);if(h.push(c),a=Math.round(i),!t.isGap&&s===o.rowArr.length-1){for(var d=s+1,g=0;d--;)g+=h[d];var f=o.conWidth-g;(f>0||f<0)&&(c+=f)}l.dom.height=a,l.dom.width=c}if(o.imgClass&&l.dom.setAttribute("class",o.imgClass),n.style.height=a+"px",o.rowClass&&n.setAttribute("class",o.rowClass),o.lightGallery){var m=document.createElement("div");m.style.display="inline-block",m.setAttribute("data-src",l.dom.src),m.appendChild(l.dom),n.appendChild(m)}else n.appendChild(l.dom)}if(o.container.appendChild(n),o.cacheImgRow.push(n),e&&o.lightGallery&&lightGallery)for(var s=0;s<o.container.children.length;s++)lightGallery(o.container.children[s],o.lightGalleryConf)}function r(i){window.onresize=function(){if(i.container.offsetWidth!==i.conWidth){i.conWidth=i.container.offsetWidth,i.rowArr=[];for(var r=i.container.childNodes,e=r.length-1;e>=0;e--)i.container.removeChild(r[e]);for(var e=0;e<i.cacheImg.length;e++)t(i,i.cacheImg[e],e)}}}var e=function(t){this.container=t.container,this.conWidth=this.container.offsetWidth,this.baseHeight=t.baseHeight||200,this.imgArr=t.imgArr,this.isGap=t.isGap,this.responsive=t.responsive,this.lightGallery=t.lightGallery,this.lightGalleryConf=t.lightGalleryConf?t.lightGalleryConf:{},this.rowClass=t.rowClass||"",this.imgClass=t.imgClass||"",this.rowArr=[],this.cacheImg=[],this.cacheImgRow=[]};return e.prototype={getImgs:function(i){var e=this;if(0!==e.imgArr.length){var o=function(n){var h=new Image;h.src=e.imgArr[n],h.onload=function(h){return n===e.imgArr.length-1&&e.responsive&&r(e),function(){var r=h.width/h.height,a={dom:h,scale:r,height:e.baseHeight,width:e.baseHeight*r};t(e,a,n),e.cacheImg.push(a),e.imgArr[n+1]?o(n+1):"function"==typeof i&&i()}}(h)};o(0)}}},e});